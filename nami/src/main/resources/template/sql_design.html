<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <!-- 引入样式 -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <!-- import Vue before Element -->
    <script src="https://unpkg.com/vue/dist/vue.js"></script>
    <!-- 引入组件库 -->
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <style>
        *{
            margin: 0;
            padding: 0;
        }
        body,html, #app{
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <div id="app">
        <el-container style="height: 100%; border: 1px solid #eee">
            <el-aside width="200px" style="background-color: rgb(238, 241, 246)">
            </el-aside>
            <el-main>
                <a href="javascript:;" @click="add_table">添加表</a>
                <div v-for="(table,i) in tables">
                    <div v-if="i == 0">主表</div>
                    <div v-else>关联表</div>

                    <el-select v-model="table.name" filterable placeholder="请选择"
                               @change="e => sel_table(e, table)"
                    >
                        <el-option
                                v-for="item in all_tables"
                                :key="item.name"
                                :label="item.name"
                                :value="item.name"
                                >
                        </el-option>
                    </el-select>

                    <div v-if="i > 0">
                        <div>
                            关联条件
                        </div>
                        <div>

                        </div>
                    </div>

                    <el-collapse v-model="table.actives">
                        <el-collapse-item title="表字段" name="select">
                            <el-table
                                    :data="table.fields"
                                    border
                                    style="width: 100%">
                                <el-table-column
                                        type="selection"
                                        width="55">
                                </el-table-column>
                                <el-table-column
                                        prop="name"
                                        label="字段名"
                                        width="180">
                                </el-table-column>
                                <el-table-column
                                        prop="comment"
                                        label="字段注释">
                                </el-table-column>
                            </el-table>
                        </el-collapse-item>
                        <el-collapse-item title="自定义字段" name="appendWhere">

                        </el-collapse-item>
                        <el-collapse-item title="条件" name="where">

                        </el-collapse-item>
                    </el-collapse>
                </div>
            </el-main>
        </el-container>
    </div>
</body>
</html>
<script>
    var app = new Vue({
        el:"#app",
        data(){
            return {
                tables:[],
                all_tables:{}
            }
        },
        methods:{
            add_table(){
                var obj = {
                    name: "请选择",
                    fields: [],
                    actives:[]
                };
                this.tables.push(obj)
            },
            sel_table(e, table){
                console.log(arguments)
                table.fields = []
                this.all_tables[e].fields.forEach(i => {
                    var item = JSON.parse(JSON.stringify(i));
                    //补充字段
                    // item.custom = false;
                    item.checked = false;
                    table.fields.push(item)
                });
            }
        }
    });


    fetch('http://127.0.0.1:8083/sqltool/sqltool/getTables').then(res => res.json()).then(res => {
        app.all_tables = res;
        alert("ok")
    });
</script>